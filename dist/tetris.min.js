/*! Tetris - v0.1.0 - 2014-02-14
* https://github.com/viclm/tetris
* Copyright (c) 2014 viclm; Licensed MIT */
!function(a){function b(b){function c(){B&&(A++,y=100*(10-A),r.level(A),10!==A&&setTimeout(arguments.callee,6e4))}function d(){w=t[Math.floor(7*Math.random())],w.index=Math.floor(Math.random()*w.length),u=w,v=u.index,l(F,F.canvas.width,F.canvas.height),n(F,0,0,w[w.index],r.unit,w.color),e(),y=100*(10-A),f()}function e(){var a=u.index+1;a>=u.length&&(a=0),tmatrix=u[a],C>=0&&C+tmatrix.length<=r.width&&(v=tmatrix,u.index=a)}function f(){if(k(E,C,D,r.width,r.height,v,r.unit),i(C,D,v,r.height)){clearTimeout(x),x=null,j(C,D,v);for(var a=!1,b=0;b<s[0].length;b++)if(s[0][b]){a=!0;break}a?(B=!1,r.over()):(C=5,D=0,d())}else D+=1,x=setTimeout(arguments.callee,y)}function g(a,b,c){for(var d=0,e=c.length;e>d;d++){for(var f=c[d],g=0,h=0,i=f.length;i>h;h++)if(f[h]&&(g++,0>a+d-1||s[b+h][a+d-1]))return!0;if(g===f.length)break}return!1}function h(a,b,c,d){for(var e=c.length-1;e>-1;e--){for(var f=c[e],g=0,h=0,i=f.length;i>h;h++)if(f[h]&&(g++,a+e+1>d-1||s[b+h][a+e+1]))return!0;if(g===f.length)break}return!1}function i(a,b,c,d){for(var e=c.length-1;e>-1;e--)for(var f=c[e],g=f.length;g>-1;g--)if(f[g]){if(b+g+1>d-1||s[b+g+1][a+e])return!0;break}return!1}function j(a,b,c){for(var d=0,e=c.length;e>d;d++)for(var f=c[d],g=0,h=f.length;h>g;g++)f[g]&&(s[b+g][a+d]=u.color)}function k(a,b,c,d,e,f,g){l(a,d*g,e*g),n(a,b,c,f,g,u.color),m(a,s,g)}function l(a,b,c){a.clearRect(0,0,b,c)}function m(a,b,c){for(var d=0,e=b.length;e>d;d++){for(var f=b[d],g=0,h=0,i=f.length;i>h;h++)f[h]&&(o(a,h*c,d*c,c,c,f[h]),g++);g===f.length&&(b.splice(d,1),b.unshift(new Array(f.length)),z+=10,r.score(z))}}function n(a,b,c,d,e,f){for(var g=0;g<d.length;g++)for(var h=0;h<d[g].length;h++)d[g][h]&&o(a,b*e+g*e,c*e+h*e,e,e,f)}function o(a,b,c,d,e,f){a.beginPath(),a.fillStyle=f,a.rect(b,c,d-2,e-2),a.fill(),a.closePath()}function p(){t=[],t[0]=[],t[0].color="#f00",t[0][0]=[[1,1,1],[0,1,0]],t[0][1]=[[0,1],[1,1],[0,1]],t[0][2]=[[0,1,0],[1,1,1]],t[0][3]=[[1,0],[1,1],[1,0]],t[1]=[],t[1].color="#0f0",t[1][0]=[[1,1],[0,1],[0,1]],t[1][1]=[[1,1,1],[1,0,0]],t[1][2]=[[1,0],[1,0],[1,1]],t[1][3]=[[0,0,1],[1,1,1]],t[2]=[],t[2].color="#00f",t[2][0]=[[1,1],[1,0],[1,0]],t[2][1]=[[1,0,0],[1,1,1]],t[2][2]=[[0,1],[0,1],[1,1]],t[2][3]=[[1,1,1],[0,0,1]],t[3]=[],t[3].color="#ff0",t[3][0]=[[0,1],[1,1],[1,0]],t[3][1]=[[1,1,0],[0,1,1]],t[4]=[],t[4].color="#f0f",t[4][0]=[[1,0],[1,1],[0,1]],t[4][1]=[[0,1,1],[1,1,0]],t[5]=[],t[5].color="#0ff",t[5][0]=[[1,1,1,1]],t[5][1]=[[1],[1],[1],[1]],t[6]=[],t[6].color="#000",t[6][0]=[[1,1],[1,1]],s=[];for(var a=0;a<r.height;a++)s.push(new Array(r.width));z=0,A=0}function q(){for(var a="0123456789abcdef",b="#",c=0;6>c;c++)b+=a.charAt(16*Math.random());return"#000000"===b?q():b}b=b||{};var r={canvas:"#canvas",tips:"#tips",unit:25,width:12,height:20,score:function(){},level:function(){},over:function(){},start:function(){},parse:function(){}};a.extend(r,b);var s,t,u,v,w,x,y,z,A,B,C=r.width/2-1,D=0,E=a(r.canvas).get(0).getContext("2d"),F=a(r.tips).get(0).getContext("2d");return p(),a(document).keydown(function(a){if(B){var b=a.which;if(37===b||39===b||38===b||40===b){switch(b){case 37:g(C,D,v)||(C-=1);break;case 39:h(C,D,v,r.width)||(C+=1);break;case 38:e(),k(E,C,D,r.width,r.height,v,r.unit);break;case 40:y=25,clearTimeout(x),f()}return k(E,C,D,r.width,r.height,v,r.unit),a.preventDefault,!1}}}),{play:function(){B=!0,c(),d()},pause:function(){clearTimeout(x),x=null,B=!1},restore:function(){f(),B=!0,setTimeout(c,6e4)},reset:function(){}}}window.tetris=b}(jQuery);